<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dsem">
<title>Demonstration of selected features â€¢ dsem</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Demonstration of selected features">
<meta property="og:description" content="dsem">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dsem</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette.html">Demonstration of selected features</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/James-Thorson-NOAA/dsem/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Demonstration of selected features</h1>
                        <h4 data-toc-skip class="author">James
Thorson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/James-Thorson-NOAA/dsem/blob/HEAD/vignettes/vignette.Rmd" class="external-link"><code>vignettes/vignette.Rmd</code></a></small>
      <div class="d-none name"><code>vignette.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://james-thorson-noaa.github.io/dsem/" class="external-link">dsem</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dynlm</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/reshape" class="external-link">reshape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ax3man.github.io/phylopath/" class="external-link">phylopath</a></span><span class="op">)</span></span></code></pre></div>
<p><code>dsem</code> is an R package for fitting dynamic structural
equation models (DSEMs) with a simple user-interface and generic
specification of simultaneous and lagged effects in a non-recursive
structure. We here highlight a few features in particular.</p>
<div class="section level2">
<h2 id="comparison-with-dynamic-linear-models">Comparison with dynamic linear models<a class="anchor" aria-label="anchor" href="#comparison-with-dynamic-linear-models"></a>
</h2>
<p>We first demonstrate that <code>dsem</code> gives identical results
to <code>dynlm</code> for a well-known econometric model, the Klein-1
model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">KleinI</span>, package<span class="op">=</span><span class="st">"AER"</span><span class="op">)</span></span>
<span><span class="va">TS</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">KleinI</span>, <span class="st">"time"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">KleinI</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1931</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># dynlm</span></span>
<span><span class="va">fm_cons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dynlm/man/dynlm.html" class="external-link">dynlm</a></span><span class="op">(</span><span class="va">consumption</span> <span class="op">~</span> <span class="va">cprofits</span> <span class="op">+</span> <span class="fu">L</span><span class="op">(</span><span class="va">cprofits</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">pwage</span> <span class="op">+</span> <span class="va">gwage</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">TS</span><span class="op">)</span></span>
<span><span class="va">fm_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dynlm/man/dynlm.html" class="external-link">dynlm</a></span><span class="op">(</span><span class="va">invest</span> <span class="op">~</span> <span class="va">cprofits</span> <span class="op">+</span> <span class="fu">L</span><span class="op">(</span><span class="va">cprofits</span><span class="op">)</span> <span class="op">+</span> <span class="va">capital</span>, data <span class="op">=</span> <span class="va">TS</span><span class="op">)</span>                 <span class="co">#</span></span>
<span><span class="va">fm_pwage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dynlm/man/dynlm.html" class="external-link">dynlm</a></span><span class="op">(</span><span class="va">pwage</span> <span class="op">~</span> <span class="va">gnp</span> <span class="op">+</span> <span class="fu">L</span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span> <span class="op">+</span> <span class="va">time</span>, data <span class="op">=</span> <span class="va">TS</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># dsem</span></span>
<span><span class="va">sem</span> <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">  # Link, lag, param_name</span></span>
<span><span class="st">  cprofits -&gt; consumption, 0, a1</span></span>
<span><span class="st">  cprofits -&gt; consumption, 1, a2</span></span>
<span><span class="st">  pwage -&gt; consumption, 0, a3</span></span>
<span><span class="st">  gwage -&gt; consumption, 0, a3</span></span>
<span><span class="st"></span></span>
<span><span class="st">  cprofits -&gt; invest, 0, b1</span></span>
<span><span class="st">  cprofits -&gt; invest, 1, b2</span></span>
<span><span class="st">  capital -&gt; invest, 0, b3</span></span>
<span><span class="st"></span></span>
<span><span class="st">  gnp -&gt; pwage, 0, c2</span></span>
<span><span class="st">  gnp -&gt; pwage, 1, c3</span></span>
<span><span class="st">  time -&gt; pwage, 0, c1</span></span>
<span><span class="st">"</span></span>
<span><span class="va">tsdata</span> <span class="op">=</span> <span class="va">TS</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span>,<span class="st">"gnp"</span>,<span class="st">"pwage"</span>,<span class="st">"cprofits"</span>,<span class="st">'consumption'</span>,</span>
<span>               <span class="st">"gwage"</span>,<span class="st">"invest"</span>,<span class="st">"capital"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/dsem.html">dsem</a></span><span class="op">(</span> sem<span class="op">=</span><span class="va">sem</span>,</span>
<span>            tsdata <span class="op">=</span> <span class="va">tsdata</span>,</span>
<span>            estimate_delta0 <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            control <span class="op">=</span> <span class="fu"><a href="../reference/dsem_control.html">dsem_control</a></span><span class="op">(</span></span>
<span>              quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              newton_loops <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; 1 regions found.</span></span>
<span><span class="co">#&gt; Using 1 threads</span></span>
<span><span class="co">#&gt; 1 regions found.</span></span>
<span><span class="co">#&gt; Using 1 threads</span></span>
<span></span>
<span><span class="co"># Compile</span></span>
<span><span class="va">m1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm_cons</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm_inv</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm_pwage</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">m2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,<span class="op">]</span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"var"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>,<span class="va">m1</span>,<span class="st">"method"</span><span class="op">=</span><span class="st">"OLS"</span>,<span class="st">"eq"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="st">"I"</span>,<span class="st">"Wp"</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"var"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>,<span class="va">m2</span>,<span class="st">"method"</span><span class="op">=</span><span class="st">"GMRF"</span>,<span class="st">"eq"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="st">"I"</span>,<span class="st">"Wp"</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"lower"</span><span class="op">=</span><span class="va">m</span><span class="op">$</span><span class="va">Estimate</span><span class="op">-</span><span class="va">m</span><span class="op">$</span><span class="va">Std..Error</span>, <span class="st">"upper"</span><span class="op">=</span><span class="va">m</span><span class="op">$</span><span class="va">Estimate</span><span class="op">+</span><span class="va">m</span><span class="op">$</span><span class="va">Std..Error</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># ggplot estimates</span></span>
<span></span>
<span><span class="va">longform</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape/man/melt-24.html" class="external-link">melt</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">KleinI</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="va">longform</span><span class="op">$</span><span class="va">year</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">KleinI</span><span class="op">)</span>, <span class="fl">9</span> <span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">longform</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">value</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span> rows<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, scales<span class="op">=</span><span class="st">"free"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">m</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">var</span>,<span class="va">eq</span><span class="op">)</span>, y<span class="op">=</span><span class="va">Estimate</span>, color<span class="op">=</span><span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span> position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span>,ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 width<span class="op">=</span><span class="fl">0.25</span>, position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>  <span class="co">#</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="fu"><a href="../reference/as_fitted_DAG.html">as_fitted_DAG</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="fu"><a href="../reference/as_fitted_DAG.html">as_fitted_DAG</a></span><span class="op">(</span><span class="va">fit</span>, lag<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, text_size<span class="op">=</span><span class="fl">4</span> <span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>,<span class="fl">1</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-2-2.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">arrangeGrob</a></span><span class="op">(</span><span class="va">p3</span>, <span class="va">p4</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-2-3.png" width="672"></p>
<p>Results show that both packages provide (almost) identical estimates
and standard errors.</p>
<p>We can also compare results using the Laplace approximation against
those obtained via numerical integration of random effects using MCMC.
In this example, MCMC results in somewhat higher estimates of exogenous
variance parameters (presumably because those follow a chi-squared
distribution with positive skewness), but otherwise the two produce
similar estimates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tmbstan</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MCMC for both fixed and random effects</span></span>
<span><span class="va">mcmc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tmbstan/man/tmbstan.html" class="external-link">tmbstan</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">$</span><span class="va">obj</span>, init<span class="op">=</span><span class="st">"last.par.best"</span> <span class="op">)</span></span>
<span><span class="va">summary_mcmc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mcmc</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># long-form data frame</span></span>
<span><span class="va">m1</span> <span class="op">=</span> <span class="va">summary_mcmc</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">17</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mean'</span>,<span class="st">'sd'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span> <span class="st">"b"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">m2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">17</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Estimate'</span>,<span class="st">'Std. Error'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">'mean'</span><span class="op">=</span><span class="va">m1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="st">'sd'</span><span class="op">=</span><span class="va">m1</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="st">'par'</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>, <span class="st">"method"</span><span class="op">=</span><span class="st">"MCMC"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">'mean'</span><span class="op">=</span><span class="va">m2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="st">'sd'</span><span class="op">=</span><span class="va">m2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="st">'par'</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>, <span class="st">"method"</span><span class="op">=</span><span class="st">"LA"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">lower</span> <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">mean</span> <span class="op">-</span> <span class="va">m</span><span class="op">$</span><span class="va">sd</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">upper</span> <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">mean</span> <span class="op">+</span> <span class="va">m</span><span class="op">$</span><span class="va">sd</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">m</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">par</span>, y<span class="op">=</span><span class="va">mean</span>, col<span class="op">=</span><span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span> position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span>,ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 width<span class="op">=</span><span class="fl">0.25</span>, position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>  <span class="co">#</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="comparison-with-vector-autoregressive-models">Comparison with vector autoregressive models<a class="anchor" aria-label="anchor" href="#comparison-with-vector-autoregressive-models"></a>
</h2>
<p>We next demonstrate that <code>dsem</code> gives similar results to a
vector autoregressive (VAR) model. To do so, we analyze population
abundance of wolf and moose populations on Isle Royale from 1959 to
2019, downloaded from their website (Vucetich, JA and Peterson RO. 2012.
The population biology of Isle Royale wolves and moose: an overview.
URL: www.isleroyalewolf.org).</p>
<p>This dataset was previously analyzed by in Chapter 14 of the User
Manual for the R-package MARSS (Holmes, E. E., M. D. Scheuerell, and E.
J. Ward (2023) Analysis of multivariate time-series using the MARSS
package. Version 3.11.8. NOAA Fisheries, Northwest Fisheries Science
Center, 2725 Montlake Blvd E., Seattle, WA 98112, DOI:
10.5281/zenodo.5781847).</p>
<p>Here, we compare fits using <code>dsem</code> with
<code>dynlm</code>, as well as a vector autoregressive model package
<code>vars</code>, and finally with <code>MARSS</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">isle_royale</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">isle_royale</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, start<span class="op">=</span><span class="fl">1959</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sem</span> <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">  # Link, lag, param_name</span></span>
<span><span class="st">  wolves -&gt; wolves, 1, arW</span></span>
<span><span class="st">  moose -&gt; wolves, 1, MtoW</span></span>
<span><span class="st">  wolves -&gt; moose, 1, WtoM</span></span>
<span><span class="st">  moose -&gt; moose, 1, arM</span></span>
<span><span class="st">"</span></span>
<span><span class="co"># initial first without delta0 (to improve starting values)</span></span>
<span><span class="va">fit0</span> <span class="op">=</span> <span class="fu"><a href="../reference/dsem.html">dsem</a></span><span class="op">(</span> sem <span class="op">=</span> <span class="va">sem</span>,</span>
<span>             tsdata <span class="op">=</span> <span class="va">data</span>,</span>
<span>             estimate_delta0 <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             control <span class="op">=</span> <span class="fu"><a href="../reference/dsem_control.html">dsem_control</a></span><span class="op">(</span></span>
<span>               quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               getsd <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in nlminb(start = out$opt$par, objective = obj$fn, gradient = obj$gr, :</span></span>
<span><span class="co">#&gt; NA/NaN function evaluation</span></span>
<span><span class="co"># Refit with delta0</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/dsem.html">dsem</a></span><span class="op">(</span> sem <span class="op">=</span> <span class="va">sem</span>,</span>
<span>            tsdata <span class="op">=</span> <span class="va">data</span>,</span>
<span>            estimate_delta0 <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            control <span class="op">=</span> <span class="fu"><a href="../reference/dsem_control.html">dsem_control</a></span><span class="op">(</span> quiet<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                                    parameters <span class="op">=</span> <span class="va">fit0</span><span class="op">$</span><span class="va">obj</span><span class="op">$</span><span class="va">env</span><span class="op">$</span><span class="fu">parList</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># dynlm</span></span>
<span><span class="va">fm_wolf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dynlm/man/dynlm.html" class="external-link">dynlm</a></span><span class="op">(</span> <span class="va">wolves</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu">L</span><span class="op">(</span><span class="va">wolves</span><span class="op">)</span> <span class="op">+</span> <span class="fu">L</span><span class="op">(</span><span class="va">moose</span><span class="op">)</span>, data<span class="op">=</span><span class="va">data</span> <span class="op">)</span>   <span class="co">#</span></span>
<span><span class="va">fm_moose</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dynlm/man/dynlm.html" class="external-link">dynlm</a></span><span class="op">(</span> <span class="va">moose</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu">L</span><span class="op">(</span><span class="va">wolves</span><span class="op">)</span> <span class="op">+</span> <span class="fu">L</span><span class="op">(</span><span class="va">moose</span><span class="op">)</span>, data<span class="op">=</span><span class="va">data</span> <span class="op">)</span>   <span class="co">#</span></span>
<span></span>
<span><span class="co"># MARSS</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://atsa-es.github.io/MARSS/" class="external-link">MARSS</a></span><span class="op">)</span></span>
<span><span class="va">z.royale.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,center<span class="op">=</span><span class="cn">TRUE</span>,scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">royale.model.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Z <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  B <span class="op">=</span> <span class="st">"unconstrained"</span>,</span>
<span>  Q <span class="op">=</span> <span class="st">"diagonal and unequal"</span>,</span>
<span>  R <span class="op">=</span> <span class="st">"zero"</span>,</span>
<span>  U <span class="op">=</span> <span class="st">"zero"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">kem.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://atsa-es.github.io/MARSS/reference/MARSS.html" class="external-link">MARSS</a></span><span class="op">(</span><span class="va">z.royale.dat</span>, model <span class="op">=</span> <span class="va">royale.model.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Success! algorithm run for 15 iterations. abstol and log-log tests passed.</span></span>
<span><span class="co">#&gt; Alert: conv.test.slope.tol is 0.5.</span></span>
<span><span class="co">#&gt; Test with smaller values (&lt;0.1) to ensure convergence.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MARSS fit is</span></span>
<span><span class="co">#&gt; Estimation method: kem </span></span>
<span><span class="co">#&gt; Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span></span>
<span><span class="co">#&gt; Algorithm ran 15 (=minit) iterations and convergence was reached. </span></span>
<span><span class="co">#&gt; Log-likelihood: -3.21765 </span></span>
<span><span class="co">#&gt; AIC: 22.4353   AICc: 23.70964   </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;                       Estimate</span></span>
<span><span class="co">#&gt; B.(1,1)                 0.8669</span></span>
<span><span class="co">#&gt; B.(2,1)                -0.1240</span></span>
<span><span class="co">#&gt; B.(1,2)                 0.1417</span></span>
<span><span class="co">#&gt; B.(2,2)                 0.8176</span></span>
<span><span class="co">#&gt; Q.(X.wolves,X.wolves)   0.1341</span></span>
<span><span class="co">#&gt; Q.(X.moose,X.moose)     0.0284</span></span>
<span><span class="co">#&gt; x0.X.wolves             0.2324</span></span>
<span><span class="co">#&gt; x0.X.moose             -0.6476</span></span>
<span><span class="co">#&gt; Initial states (x0) defined at t=0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Standard errors have not been calculated. </span></span>
<span><span class="co">#&gt; Use MARSSparamCIs to compute CIs and bias estimates.</span></span>
<span><span class="va">SE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://atsa-es.github.io/MARSS/reference/MARSSparamCIs.html" class="external-link">MARSSparamCIs</a></span><span class="op">(</span> <span class="va">kem.1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Using VAR package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.pfaffikus.de" class="external-link">vars</a></span><span class="op">)</span></span>
<span><span class="va">var</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vars/man/VAR.html" class="external-link">VAR</a></span><span class="op">(</span> <span class="va">data</span>, type<span class="op">=</span><span class="st">"const"</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">### Compile</span></span>
<span><span class="va">m1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/urca/man/summary-methods.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm_wolf</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/urca/man/summary-methods.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm_moose</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">m2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/urca/man/summary-methods.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="op">]</span></span>
<span><span class="co">#m2 = cbind( "Estimate"=fit$opt$par, "Std. Error"=fit$sdrep$par.fixed )[1:4,]</span></span>
<span><span class="va">m3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">SE</span><span class="op">$</span><span class="va">parMean</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span>, <span class="va">SE</span><span class="op">$</span><span class="va">par.se</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span>
<span><span class="va">m4</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/urca/man/summary-methods.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">var</span><span class="op">$</span><span class="va">varresult</span><span class="op">$</span><span class="va">wolves</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">-</span><span class="fl">3</span>,<span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/urca/man/summary-methods.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">var</span><span class="op">$</span><span class="va">varresult</span><span class="op">$</span><span class="va">moose</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">-</span><span class="fl">3</span>,<span class="op">]</span> <span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Bundle</span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"var"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>, <span class="va">m1</span>, <span class="st">"method"</span><span class="op">=</span><span class="st">"dynlm"</span>, <span class="st">"eq"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wolf"</span>,<span class="st">"Moose"</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"var"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>, <span class="va">m2</span>, <span class="st">"method"</span><span class="op">=</span><span class="st">"dsem"</span>, <span class="st">"eq"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wolf"</span>,<span class="st">"Moose"</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"var"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>, <span class="va">m3</span>, <span class="st">"method"</span><span class="op">=</span><span class="st">"MARSS"</span>, <span class="st">"eq"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wolf"</span>,<span class="st">"Moose"</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"var"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>, <span class="va">m4</span>, <span class="st">"method"</span><span class="op">=</span><span class="st">"vars"</span>, <span class="st">"eq"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wolf"</span>,<span class="st">"Moose"</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#knitr::kable( m1, digits=3)</span></span>
<span><span class="co">#knitr::kable( m2, digits=3)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"lower"</span><span class="op">=</span><span class="va">m</span><span class="op">$</span><span class="va">Estimate</span><span class="op">-</span><span class="va">m</span><span class="op">$</span><span class="va">Std..Error</span>, <span class="st">"upper"</span><span class="op">=</span><span class="va">m</span><span class="op">$</span><span class="va">Estimate</span><span class="op">+</span><span class="va">m</span><span class="op">$</span><span class="va">Std..Error</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># ggplot estimates ... interaction(x,y) causes an error sometimes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span></span>
<span><span class="va">longform</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span> <span class="va">isle_royale</span>, idvar <span class="op">=</span> <span class="st">"year"</span>, direction<span class="op">=</span><span class="st">"long"</span>, varying<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, v.names<span class="op">=</span><span class="st">"abundance"</span>, timevar<span class="op">=</span><span class="st">"species"</span>, times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wolves"</span>,<span class="st">"moose"</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">longform</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">abundance</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span> rows<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>, scales<span class="op">=</span><span class="st">"free"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">m</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">var</span>,<span class="va">eq</span><span class="op">)</span>, y<span class="op">=</span><span class="va">Estimate</span>, color<span class="op">=</span><span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span> position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span>,ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 width<span class="op">=</span><span class="fl">0.25</span>, position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>  <span class="co">#</span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span> <span class="fu"><a href="../reference/as_fitted_DAG.html">as_fitted_DAG</a></span><span class="op">(</span><span class="va">fit</span>, lag<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, rotation<span class="op">=</span><span class="fl">0</span> <span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_loop.html" class="external-link">geom_edge_loop</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span> label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">weight</span>,<span class="fl">2</span><span class="op">)</span>, direction<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">#arrow=arrow(), , angle_calc="along", label_dodge=grid::unit(10,"points") )</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span> <span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>,</span>
<span>           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Time-series data"</span>, <span class="st">"Estimated effects"</span>, <span class="st">"Fitted path digram"</span><span class="op">)</span>,</span>
<span>           ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-7-1.png" width="480"></p>
<p>Results again show that <code>dsem</code> can estimate parameters for
a vector autoregressive model (VAM), and it exactly matches results from
<code>vars</code>, using <code>dynlm</code>, or using
<code>MARSS</code>.</p>
</div>
<div class="section level2">
<h2 id="multi-causal-ecosystem-synthesis">Multi-causal ecosystem synthesis<a class="anchor" aria-label="anchor" href="#multi-causal-ecosystem-synthesis"></a>
</h2>
<p>We next replicate an analysis involving climate, forage fishes,
stomach contents, and recruitment of a predatory fish.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bering_sea</span><span class="op">)</span></span>
<span><span class="va">Z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span> <span class="va">bering_sea</span> <span class="op">)</span></span>
<span><span class="va">family</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'fixed'</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">bering_sea</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify model</span></span>
<span><span class="va">sem</span> <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">  # Link, lag, param_name</span></span>
<span><span class="st">  log_seaice -&gt; log_CP, 0, seaice_to_CP</span></span>
<span><span class="st">  log_CP -&gt; log_Cfall, 0, CP_to_Cfall</span></span>
<span><span class="st">  log_CP -&gt; log_Esummer, 0, CP_to_E</span></span>
<span><span class="st">  log_PercentEuph -&gt; log_RperS, 0, Seuph_to_RperS</span></span>
<span><span class="st">  log_PercentCop -&gt; log_RperS, 0, Scop_to_RperS</span></span>
<span><span class="st">  log_Esummer -&gt; log_PercentEuph, 0, Esummer_to_Suph</span></span>
<span><span class="st">  log_Cfall -&gt; log_PercentCop, 0, Cfall_to_Scop</span></span>
<span><span class="st">  log_SSB -&gt; log_RperS, 0, SSB_to_RperS</span></span>
<span><span class="st"></span></span>
<span><span class="st">  log_seaice -&gt; log_seaice, 1, AR1, 0.001</span></span>
<span><span class="st">  log_CP -&gt; log_CP, 1,  AR2, 0.001</span></span>
<span><span class="st">  log_Cspring -&gt; log_Cspring, 1, AR3, 0.001</span></span>
<span><span class="st">  log_Cfall -&gt; log_Cfall, 1, AR4, 0.001</span></span>
<span><span class="st">  log_Esummer -&gt; log_Esummer, 1, AR5, 0.001</span></span>
<span><span class="st">  log_SSB -&gt; log_SSB, 1, AR6, 0.001</span></span>
<span><span class="st">  log_RperS -&gt;  log_RperS, 1, AR7, 0.001</span></span>
<span><span class="st">  log_PercentEuph -&gt; log_PercentEuph, 1, AR8, 0.001</span></span>
<span><span class="st">  log_PercentCop -&gt; log_PercentCop, 1, AR9, 0.001</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="co"># Fit</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/dsem.html">dsem</a></span><span class="op">(</span> sem <span class="op">=</span> <span class="va">sem</span>,</span>
<span>            tsdata <span class="op">=</span> <span class="va">Z</span>,</span>
<span>            family <span class="op">=</span> <span class="va">family</span>,</span>
<span>            control <span class="op">=</span> <span class="fu"><a href="../reference/dsem_control.html">dsem_control</a></span><span class="op">(</span>use_REML<span class="op">=</span><span class="cn">FALSE</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">ParHat</span> <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">obj</span><span class="op">$</span><span class="va">env</span><span class="op">$</span><span class="fu">parList</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># summary( fit )</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Timeseries plot</span></span>
<span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>no.readonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span> mfcol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span>, mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>, tck<span class="op">=</span><span class="op">-</span><span class="fl">0.02</span> <span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">bering_sea</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tmp</span> <span class="op">=</span> <span class="va">bering_sea</span><span class="op">[</span>,<span class="va">i</span>,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">tmp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">tmp</span>, <span class="st">"PSEM"</span><span class="op">=</span><span class="va">ParHat</span><span class="op">$</span><span class="va">x_tj</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">)</span></span>
<span>  <span class="va">SD</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sdrep</span>,what<span class="op">=</span><span class="st">"Std."</span><span class="op">)</span><span class="op">$</span><span class="va">x_tj</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">tmp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">tmp</span>, <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SD</span><span class="op">)</span>,<span class="fl">0</span>,<span class="va">SD</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span> x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">bering_sea</span><span class="op">)</span>, y<span class="op">=</span><span class="va">tmp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">tmp</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        type<span class="op">=</span><span class="st">"p"</span>, main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">bering_sea</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, pch<span class="op">=</span><span class="fl">20</span>, cex<span class="op">=</span><span class="fl">2</span> <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span> x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">bering_sea</span><span class="op">)</span>, y<span class="op">=</span><span class="va">tmp</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span>,</span>
<span>         col<span class="op">=</span><span class="st">"blue"</span>, lty<span class="op">=</span><span class="st">"solid"</span> <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span> x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">bering_sea</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">bering_sea</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span> <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ax3man.github.io/phylopath/" class="external-link">phylopath</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/reshape" class="external-link">reshape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="va">longform</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape/man/melt-24.html" class="external-link">melt</a></span><span class="op">(</span> <span class="va">bering_sea</span> <span class="op">)</span></span>
<span>  <span class="va">longform</span><span class="op">$</span><span class="va">year</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="fl">1963</span><span class="op">:</span><span class="fl">2023</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">bering_sea</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">p0</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">longform</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">value</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span> rows<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, scales<span class="op">=</span><span class="st">"free"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span> <span class="op">(</span><span class="fu"><a href="../reference/as_fitted_DAG.html">as_fitted_DAG</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span>, edge.width<span class="op">=</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"width"</span>,</span>
<span>           text_size<span class="op">=</span><span class="fl">4</span>, show.legend<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>           arrow <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">'closed'</span>, <span class="fl">18</span>, <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>,<span class="st">'points'</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p1</span><span class="op">$</span><span class="va">layers</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mapping</span><span class="op">$</span><span class="va">edge_width</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span> <span class="op">(</span><span class="fu"><a href="../reference/as_fitted_DAG.html">as_fitted_DAG</a></span><span class="op">(</span><span class="va">fit</span>, what<span class="op">=</span><span class="st">"p_value"</span><span class="op">)</span><span class="op">)</span>, edge.width<span class="op">=</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"width"</span>,</span>
<span>           text_size<span class="op">=</span><span class="fl">4</span>, show.legend<span class="op">=</span><span class="cn">FALSE</span>, colors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'black'</span>, <span class="st">'black'</span><span class="op">)</span>,</span>
<span>           arrow <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">'closed'</span>, <span class="fl">18</span>, <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>,<span class="st">'points'</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span><span class="op">$</span><span class="va">layers</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mapping</span><span class="op">$</span><span class="va">edge_width</span> <span class="op">=</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="co">#grid.arrange( arrangeGrob( p0+ggtitle("timeseries"),</span></span>
<span><span class="co">#              arrangeGrob( p1+ggtitle("Estimated path diagram"),</span></span>
<span><span class="co">#                           p2+ggtitle("Estimated p-values"), nrow=2), ncol=2 ) )</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Simultaneous effects"</span>, <span class="st">"Two-sided p-value"</span><span class="op">)</span>,</span>
<span>                    ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
<p>These results are further discussed in the paper describing dsem.</p>
</div>
<div class="section level2">
<h2 id="site-replicated-trophic-cascade">Site-replicated trophic cascade<a class="anchor" aria-label="anchor" href="#site-replicated-trophic-cascade"></a>
</h2>
<p>Finally, we replicate an analysis involving a trophic cascade
involving sea stars predators, sea urchin consumers, and kelp
producers.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sea_otter</span><span class="op">)</span></span>
<span><span class="va">Z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span> <span class="va">sea_otter</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify model</span></span>
<span><span class="va">sem</span> <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">  Pycno_CANNERY_DC -&gt; log_Urchins_CANNERY_DC, 0, x2</span></span>
<span><span class="st">  log_Urchins_CANNERY_DC -&gt; log_Kelp_CANNERY_DC, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_CANNERY_DC -&gt; log_Kelp_CANNERY_DC, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_CANNERY_UC -&gt; log_Urchins_CANNERY_UC, 0, x2</span></span>
<span><span class="st">  log_Urchins_CANNERY_UC -&gt; log_Kelp_CANNERY_UC, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_CANNERY_UC -&gt; log_Kelp_CANNERY_UC, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_HOPKINS_DC -&gt; log_Urchins_HOPKINS_DC, 0, x2</span></span>
<span><span class="st">  log_Urchins_HOPKINS_DC -&gt; log_Kelp_HOPKINS_DC, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_HOPKINS_DC -&gt; log_Kelp_HOPKINS_DC, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_HOPKINS_UC -&gt; log_Urchins_HOPKINS_UC, 0, x2</span></span>
<span><span class="st">  log_Urchins_HOPKINS_UC -&gt; log_Kelp_HOPKINS_UC, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_HOPKINS_UC -&gt; log_Kelp_HOPKINS_UC, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_LOVERS_DC -&gt; log_Urchins_LOVERS_DC, 0, x2</span></span>
<span><span class="st">  log_Urchins_LOVERS_DC -&gt; log_Kelp_LOVERS_DC, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_LOVERS_DC -&gt; log_Kelp_LOVERS_DC, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_LOVERS_UC -&gt; log_Urchins_LOVERS_UC, 0, x2</span></span>
<span><span class="st">  log_Urchins_LOVERS_UC -&gt; log_Kelp_LOVERS_UC, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_LOVERS_UC -&gt; log_Kelp_LOVERS_UC, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_MACABEE_DC -&gt; log_Urchins_MACABEE_DC, 0, x2</span></span>
<span><span class="st">  log_Urchins_MACABEE_DC -&gt; log_Kelp_MACABEE_DC, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_MACABEE_DC -&gt; log_Kelp_MACABEE_DC, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_MACABEE_UC -&gt; log_Urchins_MACABEE_UC, 0, x2</span></span>
<span><span class="st">  log_Urchins_MACABEE_UC -&gt; log_Kelp_MACABEE_UC, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_MACABEE_UC -&gt; log_Kelp_MACABEE_UC, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_OTTER_PT_DC -&gt; log_Urchins_OTTER_PT_DC, 0, x2</span></span>
<span><span class="st">  log_Urchins_OTTER_PT_DC -&gt; log_Kelp_OTTER_PT_DC, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_OTTER_PT_DC -&gt; log_Kelp_OTTER_PT_DC, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_OTTER_PT_UC -&gt; log_Urchins_OTTER_PT_UC, 0, x2</span></span>
<span><span class="st">  log_Urchins_OTTER_PT_UC -&gt; log_Kelp_OTTER_PT_UC, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_OTTER_PT_UC -&gt; log_Kelp_OTTER_PT_UC, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_PINOS_CEN -&gt; log_Urchins_PINOS_CEN, 0, x2</span></span>
<span><span class="st">  log_Urchins_PINOS_CEN -&gt; log_Kelp_PINOS_CEN, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_PINOS_CEN -&gt; log_Kelp_PINOS_CEN, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_SIREN_CEN -&gt; log_Urchins_SIREN_CEN, 0, x2</span></span>
<span><span class="st">  log_Urchins_SIREN_CEN -&gt; log_Kelp_SIREN_CEN, 0, x3</span></span>
<span><span class="st">  log_Otter_Count_SIREN_CEN -&gt; log_Kelp_SIREN_CEN, 0, x4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # AR1</span></span>
<span><span class="st">  Pycno_CANNERY_DC -&gt; Pycno_CANNERY_DC, 1, ar1</span></span>
<span><span class="st">  log_Urchins_CANNERY_DC -&gt; log_Urchins_CANNERY_DC, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_CANNERY_DC -&gt; log_Otter_Count_CANNERY_DC, 1, ar3</span></span>
<span><span class="st">  log_Kelp_CANNERY_DC -&gt; log_Kelp_CANNERY_DC, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_CANNERY_UC -&gt; Pycno_CANNERY_UC, 1, ar1</span></span>
<span><span class="st">  log_Urchins_CANNERY_UC -&gt; log_Urchins_CANNERY_UC, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_CANNERY_UC -&gt; log_Otter_Count_CANNERY_UC, 1, ar3</span></span>
<span><span class="st">  log_Kelp_CANNERY_UC -&gt; log_Kelp_CANNERY_UC, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_HOPKINS_DC -&gt; Pycno_HOPKINS_DC, 1, ar1</span></span>
<span><span class="st">  log_Urchins_HOPKINS_DC -&gt; log_Urchins_HOPKINS_DC, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_HOPKINS_DC -&gt; log_Otter_Count_HOPKINS_DC, 1, ar3</span></span>
<span><span class="st">  log_Kelp_HOPKINS_DC -&gt; log_Kelp_HOPKINS_DC, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_HOPKINS_UC -&gt; Pycno_HOPKINS_UC, 1, ar1</span></span>
<span><span class="st">  log_Urchins_HOPKINS_UC -&gt; log_Urchins_HOPKINS_UC, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_HOPKINS_UC -&gt; log_Otter_Count_HOPKINS_UC, 1, ar3</span></span>
<span><span class="st">  log_Kelp_HOPKINS_UC -&gt; log_Kelp_HOPKINS_UC, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_LOVERS_DC -&gt; Pycno_LOVERS_DC, 1, ar1</span></span>
<span><span class="st">  log_Urchins_LOVERS_DC -&gt; log_Urchins_LOVERS_DC, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_LOVERS_DC -&gt; log_Otter_Count_LOVERS_DC, 1, ar3</span></span>
<span><span class="st">  log_Kelp_LOVERS_DC -&gt; log_Kelp_LOVERS_DC, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_LOVERS_UC -&gt; Pycno_LOVERS_UC, 1, ar1</span></span>
<span><span class="st">  log_Urchins_LOVERS_UC -&gt; log_Urchins_LOVERS_UC, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_LOVERS_UC -&gt; log_Otter_Count_LOVERS_UC, 1, ar3</span></span>
<span><span class="st">  log_Kelp_LOVERS_UC -&gt; log_Kelp_LOVERS_UC, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_MACABEE_DC -&gt; Pycno_MACABEE_DC, 1, ar1</span></span>
<span><span class="st">  log_Urchins_MACABEE_DC -&gt; log_Urchins_MACABEE_DC, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_MACABEE_DC -&gt; log_Otter_Count_MACABEE_DC, 1, ar3</span></span>
<span><span class="st">  log_Kelp_MACABEE_DC -&gt; log_Kelp_MACABEE_DC, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_MACABEE_UC -&gt; Pycno_MACABEE_UC, 1, ar1</span></span>
<span><span class="st">  log_Urchins_MACABEE_UC -&gt; log_Urchins_MACABEE_UC, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_MACABEE_UC -&gt; log_Otter_Count_MACABEE_UC, 1, ar3</span></span>
<span><span class="st">  log_Kelp_MACABEE_UC -&gt; log_Kelp_MACABEE_UC, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_OTTER_PT_DC -&gt; Pycno_OTTER_PT_DC, 1, ar1</span></span>
<span><span class="st">  log_Urchins_OTTER_PT_DC -&gt; log_Urchins_OTTER_PT_DC, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_OTTER_PT_DC -&gt; log_Otter_Count_OTTER_PT_DC, 1, ar3</span></span>
<span><span class="st">  log_Kelp_OTTER_PT_DC -&gt; log_Kelp_OTTER_PT_DC, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_OTTER_PT_UC -&gt; Pycno_OTTER_PT_UC, 1, ar1</span></span>
<span><span class="st">  log_Urchins_OTTER_PT_UC -&gt; log_Urchins_OTTER_PT_UC, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_OTTER_PT_UC -&gt; log_Otter_Count_OTTER_PT_UC, 1, ar3</span></span>
<span><span class="st">  log_Kelp_OTTER_PT_UC -&gt; log_Kelp_OTTER_PT_UC, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_PINOS_CEN -&gt; Pycno_PINOS_CEN, 1, ar1</span></span>
<span><span class="st">  log_Urchins_PINOS_CEN -&gt; log_Urchins_PINOS_CEN, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_PINOS_CEN -&gt; log_Otter_Count_PINOS_CEN, 1, ar3</span></span>
<span><span class="st">  log_Kelp_PINOS_CEN -&gt; log_Kelp_PINOS_CEN, 1, ar4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Pycno_SIREN_CEN -&gt; Pycno_SIREN_CEN, 1, ar1</span></span>
<span><span class="st">  log_Urchins_SIREN_CEN -&gt; log_Urchins_SIREN_CEN, 1, ar2</span></span>
<span><span class="st">  log_Otter_Count_SIREN_CEN -&gt; log_Otter_Count_SIREN_CEN, 1, ar3</span></span>
<span><span class="st">  log_Kelp_SIREN_CEN -&gt; log_Kelp_SIREN_CEN, 1, ar4</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="co"># Fit model</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/dsem.html">dsem</a></span><span class="op">(</span> sem <span class="op">=</span> <span class="va">sem</span>,</span>
<span>            tsdata <span class="op">=</span> <span class="va">Z</span>,</span>
<span>            control <span class="op">=</span> <span class="fu"><a href="../reference/dsem_control.html">dsem_control</a></span><span class="op">(</span>use_REML<span class="op">=</span><span class="cn">FALSE</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co"># summary( fit )</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ax3man.github.io/phylopath/" class="external-link">phylopath</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="va">get_part</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"log_Kelp"</span>,<span class="st">"log_Otter"</span>,<span class="st">"log_Urchin"</span>,<span class="st">"Pycno"</span><span class="op">)</span></span>
<span>  <span class="va">index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">vars</span>, FUN<span class="op">=</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">y</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">$</span><span class="va">coef</span> <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="va">index</span>,<span class="va">index</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">vars</span>, <span class="va">vars</span> <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span> <span class="fu">get_part</span><span class="op">(</span><span class="fu"><a href="../reference/as_fitted_DAG.html">as_fitted_DAG</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"width"</span>, show.legend<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p1</span><span class="op">$</span><span class="va">layers</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mapping</span><span class="op">$</span><span class="va">edge_width</span> <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span> <span class="fu">get_part</span><span class="op">(</span><span class="fu"><a href="../reference/as_fitted_DAG.html">as_fitted_DAG</a></span><span class="op">(</span><span class="va">fit</span>, what<span class="op">=</span><span class="st">"p_value"</span> <span class="op">)</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"width"</span>,</span>
<span>           show.legend<span class="op">=</span><span class="cn">FALSE</span>, colors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'black'</span>, <span class="st">'black'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span><span class="op">$</span><span class="va">layers</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mapping</span><span class="op">$</span><span class="va">edge_width</span> <span class="op">=</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="va">longform</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape/man/melt-24.html" class="external-link">melt</a></span><span class="op">(</span> <span class="va">sea_otter</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, as.is<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in type.convert.default(X[[i]], ...): 'as.is' should be specified by</span></span>
<span><span class="co">#&gt; the caller; using TRUE</span></span>
<span><span class="va">longform</span><span class="op">$</span><span class="va">X1</span> <span class="op">=</span> <span class="fl">1999</span><span class="op">:</span><span class="fl">2019</span><span class="op">[</span><span class="va">longform</span><span class="op">$</span><span class="va">X1</span><span class="op">]</span></span>
<span><span class="co">#&gt; Warning in 1999:2019[longform$X1]: numerical expression has 1008 elements: only</span></span>
<span><span class="co">#&gt; the first used</span></span>
<span><span class="va">longform</span><span class="op">$</span><span class="va">Site</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span> <span class="st">"log_Kelp_"</span>, <span class="st">""</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span> <span class="st">"log_Urchins_"</span>, <span class="st">""</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span> <span class="st">"Pycno_"</span>, <span class="st">""</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span> <span class="st">"log_Otter_Count_"</span>, <span class="st">""</span>, <span class="va">longform</span><span class="op">$</span><span class="va">X2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">longform</span><span class="op">$</span><span class="va">Species</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">longform</span><span class="op">)</span><span class="op">)</span>, FUN<span class="op">=</span>\<span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="va">longform</span><span class="op">$</span><span class="va">Site</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">""</span>,<span class="va">longform</span><span class="op">$</span><span class="va">X2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">longform</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X1</span>, y<span class="op">=</span><span class="va">value</span>, col<span class="op">=</span><span class="va">Species</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span> rows<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Site</span><span class="op">)</span>, scales<span class="op">=</span><span class="st">"free"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    <span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Simultaneous effects"</span>, <span class="st">"Two-sided p-value"</span><span class="op">)</span>,</span>
<span>                    ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-11-1.png" width="480"></p>
<p>Again, these results are further discussed in the paper describing
dsem.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by James Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
